## κ³Όμ  μ²΄ν¬ν¬μΈνΈ

### λ°°ν¬ λ§ν¬

https://youngh02.github.io/front_7th_chapter4-1/vanilla/

### κΈ°λ³Έκ³Όμ  (Vanilla SSR & SSG)

#### Express SSR μ„λ²„

- [x] Express λ―Έλ“¤μ›¨μ–΄ κΈ°λ° μ„λ²„ κµ¬ν„
- [x] κ°λ°/ν”„λ΅λ•μ… ν™κ²½ λ¶„κΈ° μ²λ¦¬
- [x] HTML ν…ν”λ¦Ώ μΉν™ (`<!--app-html-->`, `<!--app-head-->`)

#### μ„λ²„ μ‚¬μ΄λ“ λ λ”λ§

- [x] μ„λ²„μ—μ„ λ™μ‘ν•λ” Router κµ¬ν„
- [x] μ„λ²„ λ°μ΄ν„° ν”„λ¦¬νμΉ­ (μƒν’ λ©λ΅, μƒν’ μƒμ„Έ)
- [x] μ„λ²„ μƒνƒκ΄€λ¦¬ μ΄κΈ°ν™”

#### ν΄λΌμ΄μ–ΈνΈ Hydration

- [x] `window.__INITIAL_DATA__` μ¤ν¬λ¦½νΈ μ£Όμ…
- [x] ν΄λΌμ΄μ–ΈνΈ μƒνƒ λ³µμ›
- [x] μ„λ²„-ν΄λΌμ΄μ–ΈνΈ λ°μ΄ν„° μΌμΉ

#### Static Site Generation

- [x] λ™μ  λΌμ°νΈ SSG (μƒν’ μƒμ„Έ νμ΄μ§€λ“¤)
- [x] λΉλ“ νƒ€μ„ νμ΄μ§€ μƒμ„±
- [x] νμΌ μ‹μ¤ν… κΈ°λ° λ°°ν¬

### μ‹¬ν™”κ³Όμ  (React SSR & SSG)

#### React SSR

- [x] `renderToString` μ„λ²„ λ λ”λ§
- [ ] TypeScript SSR λ¨λ“ λΉλ“
- [ ] Universal React Router (μ„λ²„/ν΄λΌμ΄μ–ΈνΈ λ¶„κΈ°)
- [ ] React μƒνƒκ΄€λ¦¬ μ„λ²„ μ΄κΈ°ν™”

#### React Hydration

- [ ] Hydration λ¶μΌμΉ λ°©μ§€
- [ ] ν΄λΌμ΄μ–ΈνΈ μƒνƒ λ³µμ›

#### Static Site Generation

- [ ] λ™μ  λΌμ°νΈ SSG (μƒν’ μƒμ„Έ νμ΄μ§€λ“¤)
- [ ] λΉλ“ νƒ€μ„ νμ΄μ§€ μƒμ„±
- [ ] νμΌ μ‹μ¤ν… κΈ°λ° λ°°ν¬

## μ•„ν•! λ¨λ¨ΌνΈ (A-ha! Moment)

### Routerκ°€ μ„Έ κ°μΈ μ΄μ 

μ²μμ—λ” "μ™ Routerκ°€ μ„Έ κ°λ‚ ν•„μ”ν•μ§€?"λΌλ” μλ¬Έμ΄ μ»Έμµλ‹λ‹¤. Express Router, ServerRouter, Client Routerκ°€ κ°κ° μ–΄λ–¤ μ—­ν• μ„ ν•λ”μ§€ ν—·κ°λ Έλ”λ°, μ§μ ‘ κµ¬ν„ν•λ©΄μ„ κ°μμ μ΅΄μ¬ μ΄μ λ¥Ό λ…ν™•ν μ΄ν•΄ν–μµλ‹λ‹¤.

- **Express Router**: HTTP μ”μ²­μ„ λ°›λ” μ›Ήμ„λ²„μ κΈ°λ³Έ κΈ°λ¥
- **ServerRouter**: SSR μ‹ URL ν¨ν„΄ λ§¤μΉ­κ³Ό νμ΄μ§€ μ„ νƒ (window μ—†λ” ν™κ²½)
- **Client Router**: λΈλΌμ°μ €μ—μ„ SPA μ „ν™ (History API μ‚¬μ©)

νΉν ServerRouterλ” Node.js ν™κ²½μ—μ„ λ™μ‘ν•κΈ° λ•λ¬Έμ— `window`λ‚ `history` κ°™μ€ λΈλΌμ°μ € APIλ¥Ό μ‚¬μ©ν•  μ μ—†λ‹¤λ” μ μ΄ ν•µμ‹¬μ΄μ—μµλ‹λ‹¤. κ°™μ€ "λΌμ°ν…"μ΄μ§€λ§ ν™κ²½μ΄ λ‹¤λ¥΄λ©΄ μ™„μ „ν λ‹¤λ¥Έ κµ¬ν„μ΄ ν•„μ”ν•λ‹¤λ” κ±Έ μ²΄κ°ν–μµλ‹λ‹¤.

### Store κ²©λ¦¬μ μ¤‘μ”μ„±

μ„λ²„μ—μ„ λ§¤ μ”μ²­λ§λ‹¤ Storeλ¥Ό μ΄κΈ°ν™”ν•΄μ•Ό ν•λ” μ΄μ λ¥Ό μ²μμ—” μ΄ν•΄ν•μ§€ λ»ν–μµλ‹λ‹¤. "μ „μ—­ μƒνƒκ΄€λ¦¬μΈλ° μ™ λ§¤λ² λ¦¬μ…‹ν•μ§€?"λΌκ³  μƒκ°ν–λ”λ°, λ™μ‹ μ”μ²­ μ‹λ‚λ¦¬μ¤λ¥Ό μƒκ°ν•΄λ³΄λ‹ λ…ν™•ν•΄μ΅μµλ‹λ‹¤.

```javascript
// μ”μ²­ A: μ‚¬μ©μ 1μ΄ μƒν’ 123 μ΅°ν
productStore.dispatch({ type: "SET_PRODUCT", payload: product123 });

// μ”μ²­ B: μ‚¬μ©μ 2κ°€ μƒν’ 456 μ΅°ν (λ™μ‹)
productStore.dispatch({ type: "SET_PRODUCT", payload: product456 });
// β†’ μ‚¬μ©μ 1μ—κ² μƒν’ 456μ΄ λ³΄μ„! π±
```

μ„λ²„λ” μ—¬λ¬ μ‚¬μ©μμ μ”μ²­μ„ λ™μ‹μ— μ²λ¦¬ν•κΈ° λ•λ¬Έμ—, κ° μ”μ²­λ§λ‹¤ λ…λ¦½μ μΈ μƒνƒλ¥Ό μ μ§€ν•΄μ•Ό ν•©λ‹λ‹¤. 

### Hydrationμ λ³Έμ§

Hydrationμ΄ λ‹¨μν "μ„λ²„ HTMLμ— μ΄λ²¤νΈ λ¶™μ΄κΈ°"κ°€ μ•„λ‹λΌλ” κ±Έ μ΄ν•΄ν•λ” λ° μ‹κ°„μ΄ κ±Έλ Έμµλ‹λ‹¤. ν•µμ‹¬μ€ **μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ μ •ν™•ν κ°™μ€ HTMLμ„ μƒμ„±ν•΄μ•Ό ν•λ‹¤**λ” μ μ΄μ—μµλ‹λ‹¤.

`window.__INITIAL_DATA__`λ¥Ό ν†µν•΄ μ„λ²„μ μƒνƒλ¥Ό ν΄λΌμ΄μ–ΈνΈλ΅ μ „λ‹¬ν•κ³ , ν΄λΌμ΄μ–ΈνΈκ°€ κ°™μ€ μƒνƒλ΅ λ λ”λ§ν•΄μ„ DOM λ¶μΌμΉλ¥Ό λ°©μ§€ν•λ” λ©”μ»¤λ‹μ¦μ΄ μ§κ΄€μ μ΄μ§€λ§, UIλ¥Ό λΉ„κµν•΄μ•Όν•λ” FEμ ν•κ³„μΈκ²ƒμ²λΌ λκ»΄μ§€κΈ°λ„ ν–μµλ‹λ‹¤.

## μμ λ΅­κ² νκ³ ν•κΈ°

### Universal JavaScriptμ λ§¤λ ¥κ³Ό ν•¨μ •

κ°™μ€ μ½”λ“κ°€ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈμ—μ„ λ¨λ‘ λ™μ‘ν•λ‹¤λ” κ² λ§¤λ ¥μ μ΄λ©΄μ„λ„ μ΅°μ‹¬μ¤λ¬μ› μµλ‹λ‹¤. νμ΄μ§€ μ»΄ν¬λ„νΈλ” μ–‘μ½μ—μ„ μ‹¤ν–‰λμ§€λ§, λ°μ΄ν„° λ΅λ”© λ°©μ‹μ€ μ™„μ „ν λ‹¬λΌμ•Ό ν•©λ‹λ‹¤.

- μ„λ²„: `fs.readFileSync`λ΅ νμΌ μ½κΈ°
- ν΄λΌμ΄μ–ΈνΈ: `fetch`λ΅ API νΈμ¶

μ΄ μ°¨μ΄λ¥Ό λ…ν™•ν λ¶„λ¦¬ν•μ§€ μ•μΌλ©΄ λ°νƒ€μ„ μ—λ¬κ°€ λ°μƒν•©λ‹λ‹¤. "μ–΄λ””μ„ μ‹¤ν–‰λλ” μ½”λ“μΈκ°€?"λ¥Ό ν•­μƒ μμ‹ν•΄μ•Όν–μµλ‹λ‹¤.

### SSGμ ν¨μ¨μ„±

SSGλ¥Ό κµ¬ν„ν•λ©΄μ„ "λΉλ“ νƒ€μ„μ— λ¨λ“  νμ΄μ§€λ¥Ό λ―Έλ¦¬ λ§λ“ λ‹¤"λ” κ°λ…μ΄ μ–Όλ§λ‚ κ°•λ ¥ν•μ§€ μ²΄κ°ν–μµλ‹λ‹¤. μ„λ²„ μ—†μ΄λ„ μ™„μ „ν• HTMLμ„ μ κ³µν•  μ μκ³ , CDNμΌλ΅ λ°°ν¬ν•λ©΄ μµκ³ μ μ„±λ¥μ„ λ‚Ό μ μμµλ‹λ‹¤.

λ‹¤λ§ μƒν’μ΄ μμ² κ°λΌλ©΄ λΉλ“ μ‹κ°„μ΄ λ¬Έμ κ°€ λ  μ μλ‹¤λ” μ λ„ κ³ λ―Όν•κ² λμ—μµλ‹λ‹¤. "μ–΄λ–¤ νμ΄μ§€λ¥Ό SSGλ΅, μ–΄λ–¤ νμ΄μ§€λ¥Ό SSRλ΅ μ²λ¦¬ν• μ§€" μ „λµμ μΌλ΅ μ„ νƒν•λ” κ² μ¤‘μ”ν•λ‹¤λ” κ±Έ λ°°μ› μµλ‹λ‹¤.

## λ¦¬λ·° λ°›κ³  μ‹¶μ€ λ‚΄μ©

### 1. ServerRouterμ URL λ§¤μΉ­ μ•μ •μ„±

`packages/vanilla/src/lib/ServerRouter.js`μ μ •κ·μ‹ κΈ°λ° URL λ§¤μΉ­ λ΅μ§μ΄ λ³µμ΅ν• μΏΌλ¦¬ νλΌλ―Έν„°λ‚ νΉμλ¬Έμκ°€ ν¬ν•¨λ URLμ—μ„λ„ μ•μ •μ μΌλ΅ λ™μ‘ν• μ§€ κ²€ν†  λ¶€νƒλ“λ¦½λ‹λ‹¤. νΉν `/product/:id/` ν¨ν„΄μ—μ„ `id`μ— μμƒμΉ λ»ν• κ°’μ΄ λ“¤μ–΄μ¬ κ²½μ°μ μ²λ¦¬κ°€ μ μ ν•μ§€ ν™•μΈν•΄μ£Όμ„Έμ”.

### 2. μ„λ²„/ν΄λΌμ΄μ–ΈνΈ λ°μ΄ν„° νμΉ­ λ΅μ§ μ¤‘λ³µ

ν„μ¬ κµ¬μ΅°μ—μ„ λ°μ΄ν„° νμΉ­ λ΅μ§μ΄ μ„λ²„(`serverApi.js`)μ™€ ν΄λΌμ΄μ–ΈνΈ(`productApi.js`)μ— μ¤‘λ³µμΌλ΅ μ΅΄μ¬ν•©λ‹λ‹¤:

**μ„λ²„ (serverApi.js)**:

```javascript
export async function getProductsFromFile(params) {
  const items = await loadItems(); // fs.readFile
  const filtered = filterProducts(items, params);
  // νμ΄μ§€λ„¤μ΄μ…, μ •λ ¬ λ΅μ§...
}
```

**ν΄λΌμ΄μ–ΈνΈ (productApi.js)**:

```javascript
export async function getProducts(params) {
  const response = await fetch(`/api/products?${searchParams}`);
  return await response.json();
}
```

λ‘ ν™κ²½μ—μ„ κ°™μ€ ν•„ν„°λ§/μ •λ ¬ λ΅μ§μ„ κµ¬ν„ν•΄μ•Ό ν•κ³ , `main-server.js`μ—μ„λ„ λΌμ°νΈλ³„λ΅ λ°μ΄ν„° λ΅λ”© λ΅μ§μ΄ λ°λ³µλ©λ‹λ‹¤. μ΄λ° λ³µμ΅ν• κµ¬μ΅°κ°€ SSRμ—μ„ λ¶κ°€ν”Όν• κ²ƒμΈμ§€, μ•„λ‹λ©΄ λ” ν¨μ¨μ μΈ λ°©λ²•μ΄ μλ”μ§€ κ¶κΈν•©λ‹λ‹¤.

### 3. SSG λΉλ“ μµμ ν™”

`packages/vanilla/static-site-generate.js`μ—μ„ λ¨λ“  μƒν’ νμ΄μ§€λ¥Ό μμ°¨μ μΌλ΅ μƒμ„±ν•λ”λ°, μƒν’μ΄ 1000κ° μ΄μƒμΌλ΅ λμ–΄λ‚  κ²½μ° λΉλ“ μ‹κ°„μ΄ λ¬Έμ κ°€ λ  κ²ƒ κ°™μµλ‹λ‹¤. μ΄λ°λ¶€λ¶„λ„ λ³‘λ ¬μ²λ¦¬κ°€ κ°€λ¥ν•μ§€, λ μ‹¤λ¬΄μ—μ„ SSGλ¥Ό μ‚¬μ©ν•λ”μ§€ κ¶κΈν•©λ‹λ‹¤.

### 4. λΌμ°νΈλ³„ λ°μ΄ν„° λ΅λ”© λ΅μ§ κµ¬μ΅°ν™”

`main-server.js`μ `render` ν•¨μμ—μ„ λΌμ°νΈλ³„λ΅ if-else λ¶„κΈ°λ΅ λ°μ΄ν„°λ¥Ό λ΅λ”©ν•λ” κµ¬μ΅°κ°€ λΌμ°νΈκ°€ λμ–΄λ‚ μλ΅ λ³µμ΅ν•΄μ§ κ²ƒ κ°™μµλ‹λ‹¤:

```javascript
if (matched.path === "/") {
  // ν™νμ΄μ§€ λ°μ΄ν„° λ΅λ”©
  const [productsData, categories] = await Promise.all([...]);
} else if (matched.path === "/product/:id/") {
  // μƒν’ μƒμ„Έ λ°μ΄ν„° λ΅λ”©
  const product = await getProductByIdFromFile(productId);
}
```

Next.jsμ `getServerSideProps`μ²λΌ κ° νμ΄μ§€ μ»΄ν¬λ„νΈμ— λ°μ΄ν„° λ΅λ”© ν•¨μλ¥Ό μ—°κ²°ν•λ” ν¨ν„΄μ΄ λ” ν™•μ¥ κ°€λ¥ν• μ§€, ν„μ¬ κµ¬μ΅°μ—μ„ κ°μ„  λ°©μ•μ΄ μμ„κΉμ”?
